#!/usr/bin/env LMC3_dag.dag

## TRANSFER STAGED MEASUREMENT SETS
## transfer_measurement_sets.sub to transfer measurement sets from CASDA
## executable:
## - transfer_measurement_sets.sh
## inputs:
## - sbid: SBID
## - ms_link: file url from which to wget
## output:
## - tarball measurement set
#JOB A transfer.sub
#VARS A sbid="38814"
#PARENT A CHILD B

## UNTAR MEASUREMENT SETS
## untar transferred measurement sets
## executable: 
## - untar_measurement_sets.sh
## inputs:
## - sbid: SBID
## - ms_name: name of measurement set
## output: 
## - untarred measurement set
## JOB B untar_measurement_set
## VARS B sbid="38814"
## PARENT B CHILD C

## SHIFT PHASE CENTERS
## shift phase centers of all measurement sets to given phase center for imaging
## executable:
## - shift_phase_centre.sh
## inputs:
## - sbid: SBID
## - ra_str: ra in hms format
## - dec_str: dec in dms format
## output:
## measurement set with shifted phase center
## JOB C shift_phase_centre.sub 
## VARS C sbid="38814" ra_str=""04h32m25.1s" dec_str="-69d04m38s"
## PARENTS C CHILD D

## CONTSUB
## run continuum subtraction for all measurement sets from all VLA configurations
## executable:
## - uvcontsub.sh (runs uvcontsub.py)
## arguments:
## - sbid: SBID
## - ms_name: file name in textfile
## - chan_str: string denoting channel ranges over which to fit polynomial and remove continuum
## output:
## - cont-subbed measurement sets with '.contsub' suffix appended
## JOB D uvcontsub.sub
## VARS D sbid="38814" chan_str="0 250 850 1400 1750 2111"
## PARENT D CHILD E

## SPLIT CHANNELS
## split out user provided number of individual channels from measurement sets to be imaged
## executable:
## - split_channels.sh
## arguments:
## - sbid: SBID
## - ms_name: file name in textfile
## - sc: starting channel
## - ec: ending channel
## output:
## - measurement sets of indivdual spectral channels for each GASKAP beam
## JOB E split_channels.sub
## VARS E sbid="38814" sc="300" ec="700" 

## GENERATE CLEAN MASK

## IMAGE

## UNTAR IMAGES

## GENERATE PB IMAGE

## COMBINE (PB-CORRECT, SMOOTH to 30'')

## FEATHER

## MASK